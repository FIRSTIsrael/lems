services:
  backend:
    image: ${REGISTRY}/lems-backend:${IMAGE_TAG}
    ports:
      - '3333:3333'
    networks:
      - lems-network
    restart: always
    environment:
      # Frontend (Future use)
      # - LEMS_DOMAIN=${LEMS_DOMAIN}

      # Authentication
      - RECAPTCHA=${RECAPTCHA}
      - RECAPTCHA_SECRET_KEY=${RECAPTCHA_SECRET_KEY}
      - JWT_SECRET=${JWT_SECRET}
      - DASHBOARD_JWT_SECRET=${DASHBOARD_JWT_SECRET}

      # Database connection
      - DB_NAME=${DB_NAME}
      - MONGODB_URI=${MONGODB_URI}
      - PG_HOST=${PG_HOST}
      - PG_PORT=${PG_PORT}
      - PG_USER=${PG_USER}
      - PG_PASSWORD=${PG_PASSWORD}
      - PG_SSL_CA=${PG_SSL_CA}

      # Scheduler
      - SCHEDULER_URL=${SCHEDULER_URL}
      - SCHEDULER_JWT_SECRET=${SCHEDULER_JWT_SECRET}

      # Cloud storage
      - DIGITALOCEAN_ENDPOINT=${DIGITALOCEAN_ENDPOINT}
      - DIGITALOCEAN_SPACE=${DIGITALOCEAN_SPACE}
      - DIGITALOCEAN_KEY=${DIGITALOCEAN_KEY}
      - DIGITALOCEAN_SECRET=${DIGITALOCEAN_SECRET}

  admin:
    image: ${REGISTRY}/lems-admin:${IMAGE_TAG}
    ports:
      - '4201:4201'
    networks:
      - lems-network
    restart: always
    environment:
      # API domain (server-side only - NEXT_PUBLIC_* vars must be set at build time)
      - LOCAL_BASE_URL=${LOCAL_BASE_URL}

      # Authentication (server-side only - NEXT_PUBLIC_* vars must be set at build time)
      - RECAPTCHA=${RECAPTCHA}

  scheduler:
    image: ${REGISTRY}/lems-scheduler:${IMAGE_TAG}
    ports:
      - '8000:8000'
    networks:
      - lems-network
    restart: always
    environment:
      - LOCAL_BASE_URL="backend:3333"
      - SCHEDULER_JWT_SECRET=${SCHEDULER_JWT_SECRET}

networks:
  lems-network:
    driver: bridge
