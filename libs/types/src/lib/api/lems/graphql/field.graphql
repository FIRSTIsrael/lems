"""
Display screen type for audience display
"""
enum AudienceDisplayScreen {
  scoreboard
  match_preview
  sponsors
  logo
  message
  awards
}

"""
Awards presentation settings for the audience display
"""
type AwardsPresentation {
  "Current slide index"
  slideIndex: Int!

  "Current step in slide"
  stepIndex: Int!
}

"""
Audience display configuration
"""
type AudienceDisplay {
  "Currently active display screen"
  activeDisplay: AudienceDisplayScreen!

  "Settings for each display screen"
  settings: JSON

  "Awards presentation state"
  awardsPresentation: AwardsPresentation
}

"""
A robot game match in a division
"""
type Match {
  "Unique identifier for the match"
  id: String!

  "URL-friendly slug for the match (e.g., 'R1M3')"
  slug: String!

  "Stage of the match (PRACTICE, RANKING, or TEST)"
  stage: String!

  "Round number of the match"
  round: Int!

  "Match number within the round"
  number: Int!

  "Scheduled start time (ISO 8601 datetime)"
  scheduledTime: String!

  "Current status of the match (e.g., 'not-started', 'in-progress', 'completed')"
  status: String!

  "Whether the teams in this match were called to queue up"
  called: Boolean!

  "Actual timestamp when the match was started"
  startTime: String

  "Difference in seconds between scheduled and actual start time"
  startDelta: Int

  "Match participants at each table"
  participants("Filter participants by table IDs" tableIds: [String!]): [MatchParticipant!]!
}

"""
A team or empty slot participating in a match at a specific table
"""
type MatchParticipant {
  "Unique identifier for this participant"
  id: String!

  "Team at this table, null if no team assigned"
  team: Team

  "Table where this participant is located"
  table: Table!

  "Whether the team has arrived at the queue"
  queued: Boolean!

  "Whether the team is present"
  present: Boolean!

  "Whether the referee marked their table as ready"
  ready: Boolean!

  "ID of the match this participant is in"
  matchId: String!

  "Scoresheet for this participant's team for this match, null if no team or no scoresheet"
  scoresheet: Scoresheet
}

"""
Field-related information for a division
"""
type Field {
  "ID of the division this field data belongs to"
  divisionId: String!

  "Matches in this division, optionally filtered"
  matches(
    "Filter matches by their IDs"
    ids: [String!]

    "Filter matches by stage (PRACTICE, RANKING, TEST)"
    stage: String

    "Filter matches by match numbers"
    matchNumbers: [Int!]

    "Filter matches by round number"
    round: Int

    "Filter matches by team IDs participating in the match"
    teamIds: [String!]
  ): [Match!]!

  "Length of each match in seconds"
  matchLength: Int!

  "ID of the currently loaded match, null if none"
  loadedMatch: String

  "ID of the currently active match, null if none"
  activeMatch: String

  "Audience display state, null if none"
  audienceDisplay: AudienceDisplay

  "Current stage of the field (PRACTICE or RANKING)"
  currentStage: String!
}

extend type Division {
  "Field information for this division"
  field: Field!
}

"""
Represents an event when a match has been loaded
"""
type MatchLoadedEvent {
  "Match identifier"
  matchId: String!
}

"""
Represents an event when a match has been started
"""
type MatchStartedEvent {
  "Match identifier"
  matchId: String!

  "Actual timestamp when the match started"
  startTime: String!

  "Difference in seconds between scheduled and actual start time"
  startDelta: Int!
}

"""
Represents an event when the match stage has advanced in a division
"""
type MatchStageAdvancedEvent {
  "Placeholder field - this event type carries no data"
  _placeholder: String
}

"""
Represents an event when a match has been completed
"""
type MatchCompletedEvent {
  "Match identifier"
  matchId: String!
}

"""
Represents an event when a match endgame is triggered
"""
type MatchEndgameTriggeredEvent {
  "Match identifier"
  matchId: String!
}

"""
Represents an event when a match has been aborted
"""
type MatchAbortedEvent {
  "Match identifier"
  matchId: String!
}

"""
Represents an event when the audience display has switched
"""
type AudienceDisplaySwitchedEvent {
  "New active display"
  activeDisplay: AudienceDisplayScreen!
}

"""
Represents an event when the audience display settings was updated
"""
type AudienceDisplaySettingEvent {
  "The screen that was updated"
  display: AudienceDisplayScreen!

  "The setting key that was updated"
  settingKey: String!

  "The new value for the setting"
  settingValue: JSON!
}

"""
Represents an event when the awards presentation is updated
"""
type PresentationUpdatedEvent {
  "Awards presentation state"
  awardsPresentation: AwardsPresentation!
}

"""
Represents an event when a participant's status (present/ready) is updated
"""
type ParticipantStatusUpdatedEvent {
  "Participant identifier"
  participantId: String!

  "Timestamp when the participant was marked as present (null if not present)"
  present: String

  "Timestamp when the participant was marked as ready (null if not ready)"
  ready: String
}

extend type Mutation {
  """
  Load a match to make it the currently loaded match.
  """
  loadMatch(
    "The ID of the division containing the match"
    divisionId: String!
    "The ID of the match to load"
    matchId: String!
  ): MatchLoadedEvent!

  """
  Start a robot game match in a division.
  All participants must be marked as present before starting.
  """
  startMatch(
    "The ID of the division containing the match"
    divisionId: String!
    "The ID of the match to start"
    matchId: String!
  ): MatchStartedEvent!

  """
  Abort a robot game match that is currently in progress.
  Dequeues the pending match completion event.
  """
  abortMatch(
    "The ID of the division containing the match"
    divisionId: String!
    "The ID of the match to abort"
    matchId: String!
  ): MatchAbortedEvent!

  """
  Switch the audience display to a different screen.
  """
  switchActiveDisplay(
    "The ID of the division containing the audience display"
    divisionId: String!
    "The screen to switch the audience display to"
    newDisplay: AudienceDisplayScreen!
  ): AudienceDisplaySwitchedEvent!

  """
  Update a setting for a screen in the audience display.
  """
  updateAudienceDisplaySetting(
    "The ID of the division containing the audience display"
    divisionId: String!
    "The screen to update the setting for"
    display: AudienceDisplayScreen!
    "The setting key to update"
    settingKey: String!
    "The new value for the setting"
    settingValue: JSON!
  ): AudienceDisplaySettingEvent!

  """
  Update the awards presentation state for the audience display.
  """
  updatePresentation(
    "The ID of the division containing the audience display"
    divisionId: String!
    "The new awards presentation slide index"
    slideIndex: Int!
    "The new awards presentation step index"
    stepIndex: Int!
  ): PresentationUpdatedEvent!

  """
  Update a participant's status (present/ready) in a match.
  Called by referees to mark teams as present or ready before the match starts.
  """
  updateParticipantStatus(
    "The ID of the division containing the match"
    divisionId: String!
    "The ID of the match"
    matchId: String!
    "The ID of the participant"
    participantId: String!
    "Whether the participant is present (true/false to set/clear)"
    present: Boolean
    "Whether the participant is ready (true/false to set/clear)"
    ready: Boolean
  ): ParticipantStatusUpdatedEvent!

  """
  Set a match participant's team (or unassign by passing null).
  Used by tournament managers to assign or remove teams from match slots.
  """
  setMatchParticipantTeam(
    "The ID of the division containing the match"
    divisionId: String!
    "The ID of the match"
    matchId: String!
    "The ID of the participant"
    participantId: String!
    "The ID of the team to assign (null to unassign)"
    teamId: String
  ): Match!
}

extend type Subscription {
  """
  Subscribe to events when a match is loaded in a division.
  """
  matchLoaded("The division ID to listen for updates in" divisionId: String!): MatchLoadedEvent!

  """
  Subscribe to events when a match starts in a division.
  """
  matchStarted("The division ID to listen for updates in" divisionId: String!): MatchStartedEvent!

  """
  Subscribe to events when the match stage advances in a division.
  """
  matchStageAdvanced(
    "The division ID to listen for updates in"
    divisionId: String!
  ): MatchStageAdvancedEvent!

  """
  Subscribe to events when a match completes in a division.
  """
  matchCompleted(
    "The division ID to listen for updates in"
    divisionId: String!
  ): MatchCompletedEvent!

  """
  Subscribe to events when a match endgame is triggered in a division.
  """
  matchEndgameTriggered(
    "The division ID to listen for updates in"
    divisionId: String!
  ): MatchEndgameTriggeredEvent!

  """
  Subscribe to events when a match is aborted in a division.
  """
  matchAborted("The division ID to listen for updates in" divisionId: String!): MatchAbortedEvent!

  """
  Subscribe to events when the audience display is switched in a division.
  """
  audienceDisplaySwitched(
    "The division ID to listen for updates in"
    divisionId: String!
  ): AudienceDisplaySwitchedEvent!

  """
  Subscribe to events when an audience display setting is updated in a division.
  """
  audienceDisplaySettingUpdated(
    "The division ID to listen for updates in"
    divisionId: String!
  ): AudienceDisplaySettingEvent!

  """
  Subscribe to events when the awards presentation is updated in a division.
  """
  presentationUpdated(
    "The division ID to listen for updates in"
    divisionId: String!
  ): PresentationUpdatedEvent!

  """
  Subscribe to events when a participant's status is updated in a match.
  Emitted when a referee marks a team as present or ready.
  """
  participantStatusUpdated(
    "The division ID to listen for updates in"
    divisionId: String!
  ): ParticipantStatusUpdatedEvent!
}
